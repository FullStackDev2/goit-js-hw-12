{"version":3,"file":"index.js","sources":["../src/js/main.js"],"sourcesContent":["import iziToast from 'izitoast';\r\nimport 'izitoast/dist/css/iziToast.min.css';\r\n\r\nimport SimpleLightbox from 'simplelightbox';\r\nimport 'simplelightbox/dist/simple-lightbox.min.css';\r\n\r\nimport axios from 'axios';\r\n\r\n\r\nconst form = document.querySelector('.search-form');\r\nconst gallery = document.querySelector('.gallery');\r\nconst searchLoader = document.querySelector('.search-loader');\r\nconst loadMoreBtn = document.querySelector('.load-more');\r\nconst loadMoreLoader = document.querySelector('.load-more-loader');\r\n\r\n\r\nlet isLoadMore = false;\r\nlet page = 1;\r\nlet currentQuery = '';\r\nlet totalHitsGlobal = 0;\r\n\r\nconst PER_PAGE = 40;\r\nconst API_KEY = '53768760-b5f65296e9b3085f39f459f54';\r\nconst MIN_LOADER_TIME = 800;\r\n\r\n\r\nconst lightbox = new SimpleLightbox('.gallery a', {\r\n  captionsData: 'alt',\r\n  captionDelay: 250,\r\n  captionPosition: 'bottom',\r\n});\r\n\r\nform.addEventListener('submit', onSearch);\r\nloadMoreBtn.addEventListener('click', onLoadMore);\r\n\r\n\r\nfunction onSearch(e) {\r\n  e.preventDefault();\r\n\r\n  const query = e.target.elements.query.value.trim();\r\n  if (!query) return;\r\n\r\n  currentQuery = query;\r\n  page = 1;\r\n  totalHitsGlobal = 0;\r\n  isLoadMore = false; \r\n\r\n  gallery.innerHTML = '';\r\n  loadMoreBtn.classList.add('is-hidden');\r\n\r\n  searchLoader.classList.remove('is-hidden');\r\n  fetchImages();\r\n}\r\n\r\n\r\n\r\n\r\nfunction onLoadMore() {\r\n  isLoadMore = true; \r\n  loadMoreBtn.classList.add('is-hidden');\r\n  loadMoreLoader.classList.remove('is-hidden');\r\n\r\n  page += 1;\r\n  fetchImages();\r\n}\r\n\r\n\r\nasync function fetchImages() {\r\n  const startTime = Date.now();\r\n  let imagesToRender = null;\r\n  let isError = false;\r\n\r\n  try {\r\n    const response = await axios.get('https://pixabay.com/api/', {\r\n      params: {\r\n        key: API_KEY,\r\n        q: currentQuery,\r\n        image_type: 'photo',\r\n        orientation: 'horizontal',\r\n        safesearch: true,\r\n        page,\r\n        per_page: PER_PAGE,\r\n      },\r\n    });\r\n\r\n    const { hits, totalHits } = response.data;\r\n    totalHitsGlobal = totalHits;\r\n\r\n    if (hits.length === 0 && page === 1) {\r\n      iziToast.warning({\r\n        message: 'Sorry, there are no images matching your search query.',\r\n        position: 'topRight',\r\n        backgroundColor: '#EF4040',\r\n        color: '#FFBEBE',\r\n        messageColor: '#FAFAFB',\r\n        icon: 'fa fa-times-circle',\r\n        iconColor: 'rgba(250, 250, 251, 1)',\r\n        timeout: 5000,\r\n      });\r\n    } else {\r\n      imagesToRender = hits;\r\n    }\r\n\r\n  } catch (error) {\r\n    isError = true;\r\n\r\n    iziToast.error({\r\n      message: 'Something went wrong. Please try again later.',\r\n      position: 'topRight',\r\n    });\r\n    console.error(error);\r\n  } finally {\r\n    const elapsed = Date.now() - startTime;\r\n    const remainingTime = Math.max(0, MIN_LOADER_TIME - elapsed);\r\n\r\n    setTimeout(() => {\r\n\r\n      searchLoader.classList.add('is-hidden');\r\n      loadMoreLoader.classList.add('is-hidden');\r\n\r\n      if (imagesToRender && !isError) {\r\n        renderImages(imagesToRender);\r\n      }\r\n    }, remainingTime);\r\n  }\r\n}\r\n\r\n\r\nfunction renderImages(images) {\r\n  const markup = images\r\n    .map(\r\n      img => `\r\n      <li class=\"gallery-item\">\r\n        <a href=\"${img.largeImageURL}\">\r\n          <img src=\"${img.webformatURL}\" alt=\"${img.tags}\" />\r\n        </a>\r\n        <div class=\"info\">\r\n          <p><b>Likes</b><span>${img.likes}</span></p>\r\n          <p><b>Views</b><span>${img.views}</span></p>\r\n          <p><b>Comments</b><span>${img.comments}</span></p>\r\n          <p><b>Downloads</b><span>${img.downloads}</span></p>\r\n        </div>\r\n      </li>\r\n    `\r\n    )\r\n    .join('');\r\n\r\n  gallery.insertAdjacentHTML('beforeend', markup);\r\n\r\n  waitForImages().then(() => {\r\n\r\n    lightbox.refresh();\r\n\r\n    if (isLoadMore) {\r\n  const firstCard = gallery.firstElementChild;\r\n  if (!firstCard) return;\r\n\r\n  const { height } = firstCard.getBoundingClientRect();\r\n\r\n  window.scrollBy({\r\n    top: height * 2,\r\n    behavior: 'smooth',\r\n  });\r\n}\r\n\r\n\r\nif (page * PER_PAGE < totalHitsGlobal) {\r\n  loadMoreBtn.classList.remove('is-hidden');\r\n} else {\r\n  iziToast.info({\r\n    message:\r\n      \"We're sorry, but you've reached the end of search results\",\r\n    position: 'topRight',\r\n    });\r\n    }\r\n  });\r\n}\r\n\r\nfunction waitForImages() {\r\n  const images = gallery.querySelectorAll('img');\r\n\r\n  return Promise.all(\r\n    [...images].map(\r\n      img =>\r\n        new Promise(resolve => {\r\n          if (img.complete) resolve();\r\n          else {\r\n            img.addEventListener('load', resolve);\r\n            img.addEventListener('error', resolve);\r\n          }\r\n        })\r\n    )\r\n  );\r\n}\r\n"],"names":["form","gallery","searchLoader","loadMoreBtn","loadMoreLoader","isLoadMore","page","currentQuery","totalHitsGlobal","PER_PAGE","API_KEY","MIN_LOADER_TIME","lightbox","SimpleLightbox","onSearch","onLoadMore","e","query","fetchImages","startTime","imagesToRender","isError","response","axios","hits","totalHits","iziToast","error","elapsed","remainingTime","renderImages","images","markup","img","waitForImages","firstCard","height","resolve"],"mappings":"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"}