{"version":3,"file":"index.js","sources":["../src/js/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport axios from 'axios';\n\n\nconst form = document.querySelector('.search-form');\nconst gallery = document.querySelector('.gallery');\nconst searchLoader = document.querySelector('.search-loader');\nconst loadMoreBtn = document.querySelector('.load-more');\nconst loadMoreLoader = document.querySelector('.load-more-loader');\n\n\nlet isLoadMore = false;\nlet page = 1;\nlet currentQuery = '';\nlet totalHitsGlobal = 0;\n\nconst PER_PAGE = 40;\nconst API_KEY = '53768760-b5f65296e9b3085f39f459f54';\nconst MIN_LOADER_TIME = 800;\n\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n  captionPosition: 'bottom',\n});\n\nform.addEventListener('submit', onSearch);\nloadMoreBtn.addEventListener('click', onLoadMore);\n\n\nfunction onSearch(e) {\n  e.preventDefault();\n\n  const query = e.target.elements.query.value.trim();\n  if (!query) return;\n\n  currentQuery = query;\n  page = 1;\n  totalHitsGlobal = 0;\n  isLoadMore = false; \n\n  gallery.innerHTML = '';\n  loadMoreBtn.classList.add('is-hidden');\n\n  searchLoader.classList.remove('is-hidden');\n  fetchImages();\n}\n\n\n\n\nfunction onLoadMore() {\n  isLoadMore = true; \n  loadMoreBtn.classList.add('is-hidden');\n  loadMoreLoader.classList.remove('is-hidden');\n\n  page += 1;\n  fetchImages();\n}\n\n\nasync function fetchImages() {\n  const startTime = Date.now();\n  let imagesToRender = null;\n  let isError = false;\n\n  try {\n    const response = await axios.get('https://pixabay.com/api/', {\n      params: {\n        key: API_KEY,\n        q: currentQuery,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page,\n        per_page: PER_PAGE,\n      },\n    });\n\n    const { hits, totalHits } = response.data;\n    totalHitsGlobal = totalHits;\n\n    if (hits.length === 0 && page === 1) {\n      iziToast.warning({\n        message: 'Sorry, there are no images matching your search query.',\n        position: 'topRight',\n        backgroundColor: '#EF4040',\n        color: '#FFBEBE',\n        messageColor: '#FAFAFB',\n        icon: 'fa fa-times-circle',\n        iconColor: 'rgba(250, 250, 251, 1)',\n        timeout: 5000,\n      });\n    } else {\n      imagesToRender = hits;\n    }\n\n  } catch (error) {\n    isError = true;\n\n    iziToast.error({\n      message: 'Something went wrong. Please try again later.',\n      position: 'topRight',\n    });\n    console.error(error);\n  } finally {\n    const elapsed = Date.now() - startTime;\n    const remainingTime = Math.max(0, MIN_LOADER_TIME - elapsed);\n\n    setTimeout(() => {\n\n      searchLoader.classList.add('is-hidden');\n      loadMoreLoader.classList.add('is-hidden');\n\n      if (imagesToRender && !isError) {\n        renderImages(imagesToRender);\n      }\n    }, remainingTime);\n  }\n}\n\n\nfunction renderImages(images) {\n  const markup = images\n    .map(\n      img => `\n      <li class=\"gallery-item\">\n        <a href=\"${img.largeImageURL}\">\n          <img src=\"${img.webformatURL}\" alt=\"${img.tags}\" />\n        </a>\n        <div class=\"info\">\n          <p><b>Likes</b><span>${img.likes}</span></p>\n          <p><b>Views</b><span>${img.views}</span></p>\n          <p><b>Comments</b><span>${img.comments}</span></p>\n          <p><b>Downloads</b><span>${img.downloads}</span></p>\n        </div>\n      </li>\n    `\n    )\n    .join('');\n\n  gallery.insertAdjacentHTML('beforeend', markup);\n\n  waitForImages().then(() => {\n\n    lightbox.refresh();\n\n    if (isLoadMore) {\n  const firstCard = gallery.firstElementChild;\n  if (!firstCard) return;\n\n  const { height } = firstCard.getBoundingClientRect();\n\n  window.scrollBy({\n    top: height * 2,\n    behavior: 'smooth',\n  });\n}\n\n\nif (page * PER_PAGE < totalHitsGlobal) {\n  loadMoreBtn.classList.remove('is-hidden');\n} else {\n  iziToast.info({\n    message:\n      \"We're sorry, but you've reached the end of search results\",\n    position: 'topRight',\n    });\n    }\n  });\n}\n\nfunction waitForImages() {\n  const images = gallery.querySelectorAll('img');\n\n  return Promise.all(\n    [...images].map(\n      img =>\n        new Promise(resolve => {\n          if (img.complete) resolve();\n          else {\n            img.addEventListener('load', resolve);\n            img.addEventListener('error', resolve);\n          }\n        })\n    )\n  );\n}\n"],"names":["form","gallery","searchLoader","loadMoreBtn","loadMoreLoader","isLoadMore","page","currentQuery","totalHitsGlobal","PER_PAGE","API_KEY","MIN_LOADER_TIME","lightbox","SimpleLightbox","onSearch","onLoadMore","e","query","fetchImages","startTime","imagesToRender","isError","response","axios","hits","totalHits","iziToast","error","elapsed","remainingTime","renderImages","images","markup","img","waitForImages","firstCard","height","resolve"],"mappings":"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"}